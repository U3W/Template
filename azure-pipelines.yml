# Starter pipeline
trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

jobs:
 - job: Test_WebService
   steps:
    - template: _azure-pipelines/rust.yml
      parameters:
        toolchain: nightly
    - template: _azure-pipelines/geckodriver.yml
    - template: _azure-pipelines/wasm-pack.yml

    - script: |
        cd $(Build.SourcesDirectory)/WebService/src/main/rust
        wasm-pack build
      displayName: 'Building WebAssembly'

    - script: |
        cd $(Build.SourcesDirectory)/WebService/src/main/rust
        wasm-pack test --headless --firefox
      displayName: 'Testing WebAssembly'
    - task: Gradle@2
      inputs:
        gradleWrapperFile: '$(Build.SourcesDirectory)/WebService/gradlew'
        workingDirectory: '$(Build.SourcesDirectory)/WebService'
        tasks: 'build appInstall appBuild appCopy'
        publishJUnitResults: false
        javaHomeOption: 'JDKVersion'
        sonarQubeRunAnalysis: false
      displayName: Building Spring with React
    - task: Gradle@2
      inputs:
        gradleWrapperFile: '$(Build.SourcesDirectory)/WebService/gradlew'
        workingDirectory: '$(Build.SourcesDirectory)/WebService'
        tasks: 'test'
        publishJUnitResults: false
        javaHomeOption: 'JDKVersion'
        sonarQubeRunAnalysis: false
      displayName: Testing Application
